<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>カベ合戦！</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- カスタムCSS読み込み -->
  <?!= include('css'); ?>
  
  <style>
    /* 数字を大きく見やすくするための追加スタイル */
    .wall-count-display {
      font-family: 'Zen Maru Gothic', sans-serif;
      line-height: 1;
    }
  </style>
</head>
<body>

  <!-- ヘッダー -->
  <nav class="navbar navbar-light bg-white shadow-sm sticky-top mb-3" style="border-bottom: 4px solid #fff176;">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1 fw-bold text-primary">
        🚧 カベ<ruby>合戦<rt>がっせん</rt></ruby>！
      </span>
      <button id="btn-rule" class="btn btn-outline-primary rounded-circle" style="width: 40px; height: 40px; font-weight:bold;">？</button>
    </div>
  </nav>

  <div class="container main-container flex-grow-1">
    
    <!-- ==========================
         1. セットアップ画面
         ========================== -->
    <div id="setup-screen" class="row justify-content-center align-items-center" style="min-height: 60vh;">
      <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg border-0 rounded-4 text-center p-4" style="background-color: rgba(255,255,255,0.95);">
          <div class="card-body">
            <h1 class="display-4 fw-bold text-primary mb-3">
              <ruby>道<rt>みち</rt></ruby>を<ruby>切<rt>き</rt></ruby>り<ruby>拓<rt>ひら</rt></ruby>け！
            </h1>
            <p class="lead text-muted mb-4">
              <ruby>相手<rt>あいて</rt></ruby>のゴールを<ruby>目指<rt>めざ</rt></ruby>す<ruby>対戦<rt>たいせん</rt></ruby>パズルゲーム
            </p>
            
            <div class="mb-4 text-start bg-light p-3 rounded-3">
              <label for="select-board-size" class="form-label fw-bold">
                ボードの<ruby>大<rt>おお</rt></ruby>きさ
              </label>
              <select id="select-board-size" class="form-select form-select-lg border-2">
                <option value="7">7x7 (ふつう)</option>
                <option value="9" selected>9x9 (むずかしい)</option>
                <option value="5">5x5 (かんたん)</option>
              </select>
            </div>

            <button id="btn-start" class="btn btn-primary-pop btn-lg w-100 py-3 fs-3 shadow">
              ゲーム<ruby>開始<rt>かいし</rt></ruby>！
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==========================
         2. ゲーム画面
         ========================== -->
    <div id="game-screen" class="d-none">
      
      <!-- メッセージエリア -->
      <div class="text-center mb-3">
        <h2 id="game-message" class="fw-bold bg-white d-inline-block px-4 py-2 rounded-pill shadow-sm border">
          <ruby>準備<rt>じゅんび</rt></ruby><ruby>中<rt>ちゅう</rt></ruby>...
        </h2>
      </div>

      <div class="row g-2 justify-content-center">
        <!-- プレイヤー1 (青) 情報 -->
        <div class="col-6 col-md-3 order-2 order-md-1">
          <div id="p1-panel" class="card p-2 text-center shadow-sm h-100 justify-content-center">
            <div class="fw-bold text-primary fs-5"><ruby>青<rt>あお</rt></ruby>チーム</div>
            <div class="d-flex align-items-center justify-content-center my-1">
              <span class="fs-2 me-2">🔵</span>
              <div class="text-start lh-1">
                <div style="font-size:0.8em; color:#666;">のこりカベ</div>
                <div><span id="p1-walls" class="display-4 fw-bold wall-count-display">10</span><span class="small"> <ruby>枚<rt>まい</rt></ruby></span></div>
              </div>
            </div>
            <div class="badge bg-primary mt-1 py-2" style="white-space: normal; line-height: 1.5;">
              <ruby>右<rt>みぎ</rt></ruby>へ<ruby>進<rt>すす</rt></ruby>め！ 👉
            </div>
          </div>
        </div>

        <!-- 盤面エリア -->
        <div class="col-12 col-md-6 order-1 order-md-2 d-flex justify-content-center mb-2">
          <div class="game-card">
            <div id="game-area">
              <div id="board">
                <!-- JSでマス目を生成 -->
              </div>
            </div>
          </div>
        </div>

        <!-- プレイヤー2 (赤) 情報 -->
        <div class="col-6 col-md-3 order-3 order-md-3">
          <div id="p2-panel" class="card p-2 text-center shadow-sm h-100 justify-content-center">
            <div class="fw-bold text-danger fs-5"><ruby>赤<rt>あか</rt></ruby>チーム</div>
            <div class="d-flex align-items-center justify-content-center my-1">
              <span class="fs-2 me-2">🔴</span>
              <div class="text-start lh-1">
                <div style="font-size:0.8em; color:#666;">のこりカベ</div>
                <div><span id="p2-walls" class="display-4 fw-bold wall-count-display">10</span><span class="small"> <ruby>枚<rt>まい</rt></ruby></span></div>
              </div>
            </div>
            <div class="badge bg-danger mt-1 py-2" style="white-space: normal; line-height: 1.5;">
              👈 <ruby>左<rt>ひだり</rt></ruby>へ<ruby>進<rt>すす</rt></ruby>め！
            </div>
          </div>
        </div>
      </div>

      <!-- 操作パネル (下部固定) -->
      <div class="fixed-bottom bg-white border-top py-2 px-3 shadow-lg" style="z-index: 1000;">
        <div class="container-fluid mw-800 mx-auto">
          <div class="row g-2 align-items-center">
            
            <div class="col-4">
              <button id="btn-mode-move" class="btn btn-primary-pop w-100 py-3 h-100 d-flex flex-column align-items-center justify-content-center">
                <span class="fs-3">🏃</span>
                <span class="small fw-bold"><ruby>歩<rt>ある</rt></ruby>く</span>
              </button>
            </div>
            
            <div class="col-4">
              <button id="btn-mode-wall" class="btn btn-light btn-pop w-100 py-3 h-100 d-flex flex-column align-items-center justify-content-center border">
                <span class="fs-3">🚧</span>
                <span class="small fw-bold">カベ</span>
              </button>
            </div>

            <div class="col-4">
              <!-- カベ操作用のサブコントロール -->
              <div id="wall-controls" class="d-none h-100">
                <button id="btn-rotate-wall" class="btn btn-warning w-100 py-2 h-100 fw-bold border-2 border-dark rounded-3 shadow-sm text-dark">
                  今は <b>タテ</b><br>
                  <small style="font-size:0.7em"><ruby>押<rt>お</rt></ruby>すとヨコ</small>
                </button>
              </div>
              <!-- 移動モード時はヒントを表示 -->
              <div id="move-hint" class="text-center text-muted small d-flex align-items-center justify-content-center h-100">
                <span class="d-none d-md-inline fw-bold"><ruby>光<rt>ひか</rt></ruby>るマスを<br>タップ！</span>
              </div>
            </div>

          </div>
        </div>
      </div>
      <!-- 操作パネルの裏に余白を作る（コンテンツが隠れないように） -->
      <div style="height: 110px;"></div>

    </div>
  </div>

  <!-- フッター (指定のHTML) -->
  <footer class="text-center text-muted py-3 mt-auto border-top bg-white">
    <small>© 2026 カベ合戦！ <a href="https://note.com/cute_borage86" target="_blank" class="text-decoration-none text-muted">GIGA山</a></small>
  </footer>

  <!-- JavaScript読み込み -->
  <?!= include('js'); ?>
  
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
